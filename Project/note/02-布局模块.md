# å¸ƒå±€æ¨¡å—

## è·¯ç”±è®¾è®¡

**ç›®æ ‡ï¼š**èƒ½å¤Ÿç†è§£å°å…”é²œé¡¹ç›®ä¸­çš„è·¯ç”±è®¾è®¡

**å†…å®¹ï¼š**

ä¸€çº§è·¯ç”±æœ‰ç™»å½• Login å’Œå¸ƒå±€å®¹å™¨ Layout

![image-20211229174027074](media/image-20211229174027074.png)

| è·¯å¾„           | ç»„ä»¶ï¼ˆåŠŸèƒ½ï¼‰        | åµŒå¥—çº§åˆ« |
| -------------- | ------------------- | -------- |
| /              | é¦–é¡µå¸ƒå±€å®¹å™¨ Layout | 1çº§      |
| /login         | ç™»å½•                | 1çº§      |
| /category/:idâ€‹ | åˆ†ç±»                | 2çº§      |
| /product/:id   | å•†å“è¯¦æƒ…            | 2çº§      |
| /cart          | è´­ç‰©è½¦              | 2çº§      |
| /checkout      | å¡«å†™è®¢å•            | 2çº§      |
| /pay           | æ”¯ä»˜                | 2çº§      |
| /pay/result    | æ”¯ä»˜ç»“æœ            | 2çº§      |



## é…ç½® `eslint` è§„åˆ™

```diff
/* eslint-env node */
require('@rushstack/eslint-patch/modern-module-resolution');

module.exports = {
  root: true,
+  // è‡ªå®šä¹‰è§„åˆ™
+  rules: {
+    // vueç»„ä»¶å¿…é¡»ç”¨ç»„åˆè¯: å…³é—­
+    'vue/multi-word-component-names': 'off',
+  },
  extends: [
    'plugin:vue/vue3-essential',
    'eslint:recommended',
    '@vue/eslint-config-typescript/recommended',
    '@vue/eslint-config-prettier',
  ],
  env: {
    'vue/setup-compiler-macros': true,
  },
};
```



## é…ç½®è·¯ç”±

**ç›®æ ‡ï¼š**èƒ½å¤Ÿé…ç½®å°å…”é²œå„¿é¡¹ç›®ä¸­çš„è·¯ç”±

**æ ¸å¿ƒä»£ç ï¼š**

+ åˆ›å»ºç»„ä»¶`views/Layout/index.vue`

```vue
<script setup lang="ts">
// æ³¨æ„ setup å’Œ lang="ts" éƒ½æ˜¯éœ€è¦çš„ï¼Œä¸èƒ½çœç•¥
</script>

<template>
  <div>layoutå¸ƒå±€å®¹å™¨ç»„ä»¶</div>
</template>

<style lang="less" scoped></style>

```

+ åˆ›å»ºç»„ä»¶`views/Login/index.vue`

```vue
<script setup lang="ts">
// æ³¨æ„ setup å’Œ lang="ts" éƒ½æ˜¯éœ€è¦çš„ï¼Œä¸èƒ½çœç•¥
</script>

<template>
  <div>loginç™»å½•é¡µç»„ä»¶</div>
</template>

<style lang="less" scoped></style>

```

+ åˆ›å»ºæ–‡ä»¶`router/index.ts`

```ts
import { createRouter, createWebHashHistory } from "vue-router";

const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    {
      path: "/",
      component: () => import("@/views/Layout/index.vue"),
    },
    {
      path: "/login",
      component: () => import("@/views/Login/index.vue"),
    },
  ],
});

export default router;

```

+ åœ¨`main.ts`ä¸­å¯¼å…¥

```diff
import { createApp } from 'vue'
import App from './App.vue'
import 'normalize.css'
import '@/assets/styles/common.less'
+ import router from './router'

const app = createApp(App)

+ app.use(router)
app.mount('#app')

```

+ ä¿®æ”¹`App.vue`ï¼Œé¢„ç•™è·¯ç”±å‡ºå£

```vue
<template>
  <ul>
    <li>
      <RouterLink to="/">å¸ƒå±€å®¹å™¨</RouterLink>
    </li>
    <li>
      <RouterLink to="/login">ç™»å½•é¡µ</RouterLink>
    </li>
  </ul>
  <RouterView />
</template>
```

+ æµè§ˆå™¨æŸ¥çœ‹æ•ˆæœ

æ³¨æ„äº‹é¡¹ï¼š

- script æ ‡ç­¾çš„ setup å’Œ lang="ts" å† TS é¡¹ç›®ä¸­éƒ½æ˜¯éœ€è¦çš„ï¼Œä¸èƒ½çœç•¥
- vue3 é¡¹ç›® index.vue æ–‡ä»¶åç¼€åéœ€è¦è¡¥å…¨



## Layoutå¸ƒå±€-é¡¶éƒ¨é€šæ 

**ç›®æ ‡ï¼š**èƒ½å¤Ÿå®ŒæˆLayoutç»„ä»¶çš„é¡¶éƒ¨é€šæ å¸ƒå±€

![image-20211229175807388](media/image-20211229175807388.png)

**æ ¸å¿ƒæ­¥éª¤ï¼š**

### çœ‹ä¸åˆ°å­—ä½“å›¾æ ‡ï¼Ÿ

+ åœ¨ `index.html` å¼•å…¥å­—ä½“å›¾æ ‡æ–‡ä»¶

```diff
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
+ <link rel="stylesheet" href="//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css" />
<title>å°å…”é²œå„¿</title>
```

### é™æ€ç»“æ„

- æ–°å»ºå¤´éƒ¨å¯¼èˆªç»„ä»¶

`Layout/components/app-topnav.vue`

```vue
<script setup lang="ts"></script>

<template>
  <nav class="app-topnav">
    <div class="container">
      <ul>
        <li>
          <a href="javascript:;"><i class="iconfont icon-user"></i>é»‘é©¬å…ˆé”‹</a>
        </li>
        <li><a href="javascript:;">é€€å‡ºç™»å½•</a></li>
        <li><a href="javascript:;">è¯·å…ˆç™»å½•</a></li>
        <li><a href="javascript:;">å…è´¹æ³¨å†Œ</a></li>
        <li><a href="javascript:;">æˆ‘çš„è®¢å•</a></li>
        <li><a href="javascript:;">ä¼šå‘˜ä¸­å¿ƒ</a></li>
        <li><a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a></li>
        <li><a href="javascript:;">å…³äºæˆ‘ä»¬</a></li>
        <li>
          <a href="javascript:;"><i class="iconfont icon-phone"></i>æ‰‹æœºç‰ˆ</a>
        </li>
      </ul>
    </div>
  </nav>
</template>

<style scoped lang="less">
.app-topnav {
  background: #333;
  ul {
    display: flex;
    height: 53px;
    justify-content: flex-end;
    align-items: center;
    li {
      a {
        padding: 0 15px;
        color: #cdcdcd;
        line-height: 1;
        display: inline-block;
        i {
          font-size: 14px;
          margin-right: 2px;
        }
        &:hover {
          color: @primaryColor;
        }
      }
      ~ li {
        a {
          border-left: 2px solid #666;
        }
      }
    }
  }
}
</style>

```

3ï¼‰åœ¨ `src/views/Layout.vue` ä¸­å¯¼å…¥ä½¿ç”¨

```html
<script setup lang="ts">
import AppTopnav from "./components/app-topnav.vue";
</script>

<template>
  <AppTopnav />
</template>

<style lang="less" scoped></style>

```

## Layoutå¸ƒå±€-å¤´éƒ¨å¸ƒå±€

**ç›®æ ‡ï¼š**èƒ½å¤Ÿå®ŒæˆLayoutç»„ä»¶çš„å¤´éƒ¨å¸ƒå±€

![image-20211229180517464](media/image-20211229180517464.png)

**æ ¸å¿ƒä»£ç **

+ åœ¨  `Layout/components/` ä¸‹æ–°å»º `app-header.vue` ç»„ä»¶ï¼ŒåŸºç¡€å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<script setup lang="ts">
// 
</script>

<template>
  <header class="app-header">
    <div class="container">
      <h1 class="logo">
        <RouterLink to="/">å°å…”é²œ</RouterLink>
      </h1>
      <ul class="app-header-nav">
        <li class="home">
          <RouterLink to="/">é¦–é¡µ</RouterLink>
        </li>
        <li>
          <a href="#">ç¾é£Ÿ</a>
        </li>
        <li>
          <a href="#">é¤å¨</a>
        </li>
        <li>
          <a href="#">è‰ºæœ¯</a>
        </li>
        <li>
          <a href="#">ç”µå™¨</a>
        </li>
        <li>
          <a href="#">å±…å®¶</a>
        </li>
        <li>
          <a href="#">æ´—æŠ¤</a>
        </li>
        <li>
          <a href="#">å­•å©´</a>
        </li>
        <li>
          <a href="#">æœè£…</a>
        </li>
        <li>
          <a href="#">æ‚è´§</a>
        </li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="æœä¸€æœ" />
      </div>
      <!-- è´­ç‰©è½¦ -->
      <div class="cart">
        <a class="curr" href="#">
          <i class="iconfont icon-cart"></i>
          <em>2</em>
        </a>
      </div>
    </div>
  </header>
</template>

<style scoped lang="less">
.app-header {
  background: #fff;
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    a {
      display: block;
      height: 132px;
      width: 100%;
      text-indent: -9999px;
      background: url("@/assets/images/logo.png") no-repeat center 18px /
        contain;
    }
  }
  .app-header-nav {
    width: 820px;
    display: flex;
    padding-left: 40px;
    position: relative;
    z-index: 998;
    li {
      margin-right: 40px;
      width: 38px;
      text-align: center;
      a {
        font-size: 16px;
        line-height: 32px;
        height: 32px;
        display: inline-block;
        &:hover {
          color: @primaryColor;
          border-bottom: 1px solid @primaryColor;
        }
      }
    }
  }
  .search {
    width: 170px;
    height: 32px;
    position: relative;
    border-bottom: 1px solid #e7e7e7;
    line-height: 32px;
    .icon-search {
      font-size: 18px;
      margin-left: 5px;
    }
    input {
      width: 140px;
      padding-left: 5px;
      color: #666;
    }
  }
  .cart {
    width: 50px;
    .curr {
      height: 32px;
      line-height: 32px;
      text-align: center;
      position: relative;
      display: block;
      .icon-cart {
        font-size: 22px;
      }
      em {
        font-style: normal;
        position: absolute;
        right: 0;
        top: 0;
        padding: 1px 6px;
        line-height: 1;
        background: @helpColor;
        color: #fff;
        font-size: 12px;
        border-radius: 10px;
        font-family: Arial;
      }
    }
  }
}
</style>

```

+ åœ¨ `src/views/Layout.vue` ä¸­å¯¼å…¥ä½¿ç”¨ã€‚

```diff
<script setup lang="ts">
import AppTopnav from './components/app-topnav.vue'
+ import AppHeader from './components/app-header.vue'
</script>

<template>
  <AppTopnav />
+ <AppHeader />
</template>

<style lang="scss" scoped></style>

```

### çœ‹ä¸åˆ°å›¾ç‰‡ï¼Ÿ

**æ‹·è´ç´ æåˆ°é¡¹ç›®ä¸­**

+ ğŸš¨åœ¨`assets/images/`ä¸­æä¾›å›¾ç‰‡ï¼Œåœ¨ç´ æä¸­å·²ç»æä¾›

### `nav` ç»„ä»¶æ‹†åˆ†

å› ä¸ºåœ¨åé¢çš„å¸é¡¶äº¤äº’é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¤ç”¨å¯¼èˆªéƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆç›´æ¥æŠŠä»–æ‹†åˆ†å‡ºæ¥ï¼Œæ‹†åˆ†æˆä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶

+ åœ¨`Layout/compoennts/` ä¸‹ï¼Œæ–°å»º`app-header-nav.vue`ç»„ä»¶

```vue
<script setup lang="ts">
// 
</script>

<template>
  <ul class="app-header-nav">
    <li class="home">
      <RouterLink to="/">é¦–é¡µ</RouterLink>
    </li>
    <li>
      <a href="#">ç¾é£Ÿ</a>
    </li>
    <li>
      <a href="#">é¤å¨</a>
    </li>
    <li>
      <a href="#">è‰ºæœ¯</a>
    </li>
    <li>
      <a href="#">ç”µå™¨</a>
    </li>
    <li>
      <a href="#">å±…å®¶</a>
    </li>
    <li>
      <a href="#">æ´—æŠ¤</a>
    </li>
    <li>
      <a href="#">å­•å©´</a>
    </li>
    <li>
      <a href="#">æœè£…</a>
    </li>
    <li>
      <a href="#">æ‚è´§</a>
    </li>
  </ul>
</template>

<style lang="less" scoped>
.app-header-nav {
  width: 820px;
  display: flex;
  padding-left: 40px;
  position: relative;
  z-index: 998;
  li {
    margin-right: 40px;
    width: 38px;
    text-align: center;
    a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;
    }
  }
}
</style>

```

+ åœ¨`Layout/components/app-header.vue`ä¸­

```diff
<script setup lang="ts">
import { RouterLink } from "vue-router";
+ import AppHeaderNav from "./app-header-nav.vue";
</script>


<template>
  <header class="app-header">
    <div class="container">
      <h1 class="logo"><RouterLink to="/">å°å…”é²œ</RouterLink></h1>
+      <AppHeaderNav />
      // ...
    </div>
  </header>
</template>
```

+ æŸ¥çœ‹æ•ˆæœ

## Layoutå¸ƒå±€-åº•éƒ¨

**ç›®æ ‡ï¼š**èƒ½å¤Ÿå®ŒæˆLayoutå¸ƒå±€çš„åº•éƒ¨å¸ƒå±€æ•ˆæœ

![image-20211229182504728](media/image-20211229182504728.png)

### é™æ€ç»“æ„

+ åœ¨ `Layout/components`ä¸‹ï¼Œæ–°å»º`/app-footer.vue` ç»„ä»¶ï¼ŒåŸºç¡€å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<script setup lang="ts"></script>

<template>
  <footer class="app_footer">
    <!-- è”ç³»æˆ‘ä»¬ -->
    <div class="contact">
      <div class="container">
        <dl>
          <dt>å®¢æˆ·æœåŠ¡</dt>
          <dd><i class="iconfont icon-kefu"></i> åœ¨çº¿å®¢æœ</dd>
          <dd><i class="iconfont icon-question"></i> é—®é¢˜åé¦ˆ</dd>
        </dl>
        <dl>
          <dt>å…³æ³¨æˆ‘ä»¬</dt>
          <dd><i class="iconfont icon-weixin"></i> å…¬ä¼—å·</dd>
          <dd><i class="iconfont icon-weibo"></i> å¾®åš</dd>
        </dl>
        <dl>
          <dt>ä¸‹è½½APP</dt>
          <dd class="qrcode"><img src="@/assets/images/qrcode.jpg" /></dd>
          <dd class="download">
            <span>æ‰«æäºŒç»´ç </span>
            <span>ç«‹é©¬ä¸‹è½½APP</span>
            <a href="javascript:;">ä¸‹è½½é¡µé¢</a>
          </dd>
        </dl>
        <dl>
          <dt>æœåŠ¡çƒ­çº¿</dt>
          <dd class="hotline">
            400-0000-000 <small>å‘¨ä¸€è‡³å‘¨æ—¥ 8:00-18:00</small>
          </dd>
        </dl>
      </div>
    </div>
    <!-- å…¶å®ƒ -->
    <div class="extra">
      <div class="container">
        <div class="slogan">
          <a href="javascript:;">
            <i class="iconfont icon-footer01"></i>
            <span>ä»·æ ¼äº²æ°‘</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer02"></i>
            <span>ç‰©æµå¿«æ·</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer03"></i>
            <span>å“è´¨æ–°é²œ</span>
          </a>
        </div>
        <!-- ç‰ˆæƒä¿¡æ¯ -->
        <div class="copyright">
          <p>
            <a href="javascript:;">å…³äºæˆ‘ä»¬</a>
            <a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a>
            <a href="javascript:;">å”®åæœåŠ¡</a>
            <a href="javascript:;">é…é€ä¸éªŒæ”¶</a>
            <a href="javascript:;">å•†åŠ¡åˆä½œ</a>
            <a href="javascript:;">æœç´¢æ¨è</a>
            <a href="javascript:;">å‹æƒ…é“¾æ¥</a>
          </p>
          <p>CopyRight Â© å°å…”é²œå„¿</p>
        </div>
      </div>
    </div>
  </footer>
</template>

<style scoped lang="less">
.app_footer {
  overflow: hidden;
  background-color: #f5f5f5;
  padding-top: 20px;
  .contact {
    background: #fff;
    .container {
      padding: 60px 0 40px 25px;
      display: flex;
    }
    dl {
      height: 190px;
      text-align: center;
      padding: 0 72px;
      border-right: 1px solid #f2f2f2;
      color: #999;
      &:first-child {
        padding-left: 0;
      }
      &:last-child {
        border-right: none;
        padding-right: 0;
      }
    }
    dt {
      line-height: 1;
      font-size: 18px;
    }
    dd {
      margin: 36px 12px 0 0;
      float: left;
      width: 92px;
      height: 92px;
      padding-top: 10px;
      border: 1px solid #ededed;
      .iconfont {
        font-size: 36px;
        display: block;
        color: #666;
      }
      &:hover {
        .iconfont {
          color: @primaryColor;
        }
      }
      &:last-child {
        margin-right: 0;
      }
    }
    .qrcode {
      width: 92px;
      height: 92px;
      padding: 7px;
      border: 1px solid #ededed;
    }
    .download {
      padding-top: 5px;
      font-size: 14px;
      width: auto;
      height: auto;
      border: none;
      span {
        display: block;
      }
      a {
        display: block;
        line-height: 1;
        padding: 10px 25px;
        margin-top: 5px;
        color: #fff;
        border-radius: 2px;
        background-color: @primaryColor;
      }
    }
    .hotline {
      padding-top: 20px;
      font-size: 22px;
      color: #666;
      width: auto;
      height: auto;
      border: none;
      small {
        display: block;
        font-size: 15px;
        color: #999;
      }
    }
  }
  .extra {
    background-color: #333;
  }
  .slogan {
    height: 178px;
    line-height: 58px;
    padding: 60px 100px;
    border-bottom: 1px solid #434343;
    display: flex;
    justify-content: space-between;
    a {
      height: 58px;
      line-height: 58px;
      color: #fff;
      font-size: 28px;
      i {
        font-size: 50px;
        vertical-align: middle;
        margin-right: 10px;
        font-weight: 100;
      }
      span {
        vertical-align: middle;
        text-shadow: 0 0 1px #333;
      }
    }
  }
  .copyright {
    height: 170px;
    padding-top: 40px;
    text-align: center;
    color: #999;
    font-size: 15px;
    p {
      line-height: 1;
      margin-bottom: 20px;
    }
    a {
      color: #999;
      line-height: 1;
      padding: 0 10px;
      border-right: 1px solid #999;
      &:last-child {
        border-right: none;
      }
    }
  }
}
</style>

```

+ åœ¨ `src/views/Layout.vue` ä¸­å¯¼å…¥ä½¿ç”¨ã€‚

```vue
<script setup lang="ts">
import AppTopnav from './components/app-topnav.vue'
import AppHeader from './components/app-header.vue'
import AppFooter from './components/app-footer.vue'
</script>

<template>
  <AppTopnav />
  <AppHeader />
  <main class="app-body">
    <!-- è·¯ç”±å‡ºå£ -->
  </main>
  <AppFooter />
</template>

<style lang="less" scoped>
.app-body {
  min-height: 600px;
}
</style>

```

+ æŸ¥çœ‹æ•ˆæœ

## ä½¿ç”¨ `pinia` ç®¡ç†æ•°æ®

**ç›®æ ‡ï¼š** é€šè¿‡ `pinia`  ç®¡ç†é¡¹ç›®ä¸­çš„æ•°æ®ã€‚

**æ ¸å¿ƒæ­¥éª¤ï¼š**

+ åœ¨`main.ts`ä¸­æ³¨å†Œ `pinia`

```diff
import { createApp } from 'vue'
import App from './App.vue'

import 'normalize.css'
import '@/assets/styles/common.less'

import router from './router'
+ import { createPinia } from 'pinia'
+ const pinia = createPinia()

const app = createApp(App)
app.use(router)
+ app.use(pinia)
app.mount('#app')
```

+ åˆ›å»ºæ–‡ä»¶`store/modules/home.ts`,ç”¨äºç®¡ç†homeæ¨¡å—çš„æ•°æ®

```tsx
import { defineStore } from 'pinia';
import { ref } from 'vue';

export const useHomeStore = defineStore('home', () => {
  // å‡†å¤‡å“åº”å¼æ•°æ®
  const money = ref(14000);
  // ğŸ¯è®°å¾— return è¿”å›
  return { money };
});

```

+ åˆ›å»º`store/index.ts`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„æ¨¡å—

```ts
export * from './modules/home';
```

+ åœ¨`Layout/index.vue`ä¸­æµ‹è¯•

```ts
import useHomeStore from '@/store'
const home = useHomeStore()
console.log(home.money)
```

+ æ§åˆ¶å°æŸ¥çœ‹æ•ˆæœ

## ä½¿ç”¨ `Pinia` è·å–å¤´éƒ¨åˆ†ç±»å¯¼èˆª

**ç›®æ ‡ï¼š**èƒ½å¤Ÿå‘é€è¯·æ±‚å®Œæˆåˆ†ç±»å¯¼èˆªçš„æ¸²æŸ“

**æ ¸å¿ƒä»£ç ï¼š**

+ åœ¨`store/modules/home.ts`ä¸­æä¾› state å’Œ actions

```ts
const useHomeStore = defineStore('home', {
  state: () => ({
    categoryList: []
  }),
  actions: {
    async getAllCategory() {
      const res = await request.get('/home/category/head')
      console.log(res)
    }
  }
})
```

+ åœ¨`Layout/index.vue`ä¸­å‘é€è¯·æ±‚

```vue
<script setup lang="ts">
import useStore from '@/store'
const { home } = useStore()
home.getAllCategory()
</script>
```

## TS ç±»å‹å£°æ˜æ–‡ä»¶è§„åˆ’ğŸš¨

**å®šä¹‰ç±»å‹å£°æ˜**

+ åœ¨`src\types\modules\home.d.ts`ä¸­å®šä¹‰æ•°æ®ç±»å‹

```ts
// åˆ†ç±»æ•°æ®å•é¡¹ç±»å‹
export interface Goods {
  desc: string;
  id: string;
  name: string;
  picture: string;
  price: string;
  title: string;
  alt: string;
};

export interface Children {
  id: string;
  name: string;
  picture: string;
  goods: Goods[];
};

export interface Category {
  id: string;
  name: string;
  picture: string;
  children: Children[];
  goods: Goods[];
};

// åˆ†ç±»æ•°æ®åˆ—è¡¨ç±»å‹
export type CategoryList = Category[];

```

**ç±»å‹å‡ºå£ç»Ÿä¸€**

- æ–°å»º `src\types\index.d.ts`

```ts
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ç±»å‹æ–‡ä»¶
export * from "./api/home";

```

åº”ç”¨

+ ä¿®æ”¹`store/modules/home.ts`ï¼Œç»™ `axios` è¯·æ±‚å¢åŠ æ³›å‹

```ts
import { defineStore } from "pinia";
import request from "@/utils/request";
import type { CategoryList } from "@/types";

const useHomeStore = defineStore("home", {
  state: () => ({
    categoryList: [] as CategoryList,
  }),
  actions: {
    async getAllCategory() {
      const res = await request.get("/home/category/head");
      this.categoryList = res.data.result;
    },
  },
});

export default useHomeStore;

```

+ æ¸²æŸ“åˆ†ç±»å¯¼èˆª åœ¨`Layout/components/app-header-nav.vue`ä¸­

```tsx
<script setup lang="ts">
import useStore from "@/store";
const { home } = useStore();
</script>

<template>
  <ul class="app-header-nav">
    <li class="home">
      <RouterLink to="/">é¦–é¡µ</RouterLink>
    </li>
    <li v-for="item in home.categoryList" :key="item.id">
      <a href="#">{{ item.name }}</a>
    </li>
  </ul>
</template>
```

## Axios äºŒæ¬¡å°è£…ğŸš¨ 

>  ç›®æ ‡ï¼šæ”¹å†™ Axios è¿”å›å€¼çš„ TS ç±»å‹

`Axios` äºŒæ¬¡å°è£…ï¼Œè®© `Axios` å’Œ `TS` ç±»å‹ç»„åˆä½¿ç”¨æ—¶æ›´æ–¹ä¾¿ã€‚

### Axios å†…ç½®ç±»å‹å£°æ˜è§£è¯»

```ts
// 1. Axios å®ä¾‹ç±»å‹
export class Axios {
  // ...çœç•¥
  request<T = any, R = AxiosResponse<T>>(config): Promise<R>;
  get<T = any, R = AxiosResponse<T>>(url: string, config): Promise<R>;
}

// 2. AxiosResponse è¿”å›å€¼ç±»å‹
export interface AxiosResponse<T = any, D = any>  {
  data: T;
  // ...çœç•¥
}

```

![image-20220218165657044](media/image-20220218165657044.png)

### TS ç±»å‹å‡çº§æ”¯æŒ

```diff
import { defineStore } from "pinia";
import request from "@/utils/request";
import type { CategoryList } from "@/types";

+ interface ApiRes<T = unknown> {
+   msg: string;
+   result: T;
+ }

const useHomeStore = defineStore({
  id: "home",
  state: () => ({
    categoryList: [] as CategoryList,
  }),
  actions: {
    async getAllCategory() {
-      // èƒ½ç”¨ï¼Œ res.data çš„è¿”å›å€¼ç±»å‹ä¸º any
-      const res = await request.get("/home/category/head");
+     // ğŸ‰æ­å–œå·²ç»æœ‰ TS ç±»å‹æé†’äº†ï¼Œres.data èƒ½æç¤º result å’Œæ­£ç¡®çš„ç±»å‹
+      const res = await request.get<ApiRes<CategoryList>>("/home/category/head");
      this.categoryList = res.data.result;
    },
  },
});

export default useHomeStore;
```



### TS ç±»å‹è¿›é˜¶å°è£…(å…ˆä½¿ç”¨)

- ğŸ“¦ è¯¾å ‚ä¸­å…ˆç›´æ¥ä½¿ç”¨ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚
- â° è¯¾åå¤§å®¶è‡ªè¡Œè§£è¯»ï¼Œæå‡è‡ªå·± TS ç±»å‹å¤„ç†èƒ½åŠ›ã€‚

**å‚è€ƒä»£ç **

`src\utils\request.ts`

```diff
- import axios from "axios";
+ import axios, { type Method } from "axios";

const instance = axios.create({
  baseURL: "http://pcapi-xiaotuxian-front-devtest.itheima.net/",
  timeout: 5000,
});

// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(
  function (config) {
    // åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ
    return config;
  },
  function (error) {
    // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
  }
);

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
  function (response) {
    return response;
  },
  function (error) {
    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ
    return Promise.reject(error);
  }
);

+ // åç«¯è¿”å›çš„æ¥å£æ•°æ®æ ¼å¼
+ interface ApiRes<T = unknown> {
+    msg: string;
+    result: T;
+ }

+/**
+ * axios äºŒæ¬¡å°è£…ï¼Œæ•´åˆ TS ç±»å‹
+ * @param url  è¯·æ±‚åœ°å€
+ * @param method  è¯·æ±‚ç±»å‹
+ * @param submitData  å¯¹è±¡ç±»å‹ï¼Œæäº¤æ•°æ®
+ */
+export const http = <T>(method: Method, url: string, submitData?: object) => {
+  return instance.request<ApiRes<T>>({
+    url,
+    method,
+    // ğŸ”” è‡ªåŠ¨è®¾ç½®åˆé€‚çš„ params/data é”®åç§°ï¼Œå¦‚æœ method ä¸º get ç”¨ params ä¼ è¯·æ±‚å‚æ•°ï¼Œå¦åˆ™ç”¨ data
+    [method.toUpperCase() === "GET" ? "params" : "data"]: submitData,
+  });
+};

export default instance;

```

**ä½¿ç”¨**

```diff
import { defineStore } from "pinia";
-import request from "@/utils/request";
+import { http } from "@/utils/request";

const useHomeStore = defineStore({
  id: "home",
  state: () => ({
    categoryList: [] as CategoryList,
  }),
  actions: {
    async getAllCategory() {
-      const res = await request.get<ApiRes<CategoryList>>("/home/category/head");
+      // ä½¿ç”¨èµ·æ¥ç®€æ´å¾ˆå¤š
+      const res = await http<CategoryList>("GET", "/home/category/head");
      this.categoryList = res.data.result;
    },
  },
});

export default useHomeStore;

```



## åˆ†ç±»å¯¼èˆªå¸é¡¶åŠŸèƒ½

> ç”µå•†ç½‘ç«™çš„é¦–é¡µå†…å®¹ä¼šæ¯”è¾ƒå¤šï¼Œé¡µé¢æ¯”è¾ƒé•¿ï¼Œä¸ºäº†èƒ½è®©ç”¨æˆ·åœ¨æ»šåŠ¨æµè§ˆå†…å®¹çš„è¿‡ç¨‹ä¸­éƒ½èƒ½å¤Ÿå¿«é€Ÿçš„åˆ‡æ¢åˆ°å…¶å®ƒåˆ†ç±»ã€‚éœ€è¦åˆ†ç±»å¯¼èˆªä¸€ç›´å¯è§ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¸é¡¶å¯¼èˆªçš„æ•ˆæœã€‚

**æ ¸å¿ƒæ­¥éª¤ï¼š**

**ç›®æ ‡:**  å®Œæˆå¤´éƒ¨ç»„ä»¶å¸é¡¶æ•ˆæœçš„å®ç°

**äº¤äº’è¦æ±‚**

1. æ»šåŠ¨è·ç¦»å¤§äºç­‰äº 78 çš„æ—¶å€™ï¼Œç»„ä»¶ä¼šåœ¨é¡¶éƒ¨å›ºå®šå®šä½
2. æ»šåŠ¨è·ç¦»å°äº 78 çš„æ—¶å€™ï¼Œç»„ä»¶æ¶ˆå¤±éšè—

**å®ç°æ€è·¯**

1. å‡†å¤‡ä¸€ä¸ªå¸é¡¶ç»„ä»¶ï¼Œå‡†å¤‡ä¸€ä¸ªç±»åï¼Œæ§åˆ¶æ˜¾ç¤ºéšè—
2. ç›‘å¬é¡µé¢æ»šåŠ¨ï¼Œåˆ¤æ–­æ»šåŠ¨è·ç¦»ï¼Œè·ç¦»å¤§äº 78 æ·»åŠ ç±»å

### é™æ€ç»“æ„

**æ ¸å¿ƒä»£ç ï¼š**

+ åœ¨ `Layout/components/`ä¸‹ï¼Œæ–°å»º `app-header-sticky.vue`  ç»„ä»¶

```tsx
<script setup lang="ts">
import { RouterLink } from "vue-router";
import AppHeaderNav from "./app-header-nav.vue";
</script>

<template>
  <div class="app-header-sticky" :class="{ show: true }">
    <div class="container">
      <RouterLink class="logo" to="/" />
      <AppHeaderNav />
      <div class="right">
        <RouterLink to="/">å“ç‰Œ</RouterLink>
        <RouterLink to="/">ä¸“é¢˜</RouterLink>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  // æ­¤å¤„ä¸ºå…³é”®æ ·å¼!!!
  // é»˜è®¤æƒ…å†µä¸‹å®Œå…¨æŠŠè‡ªå·±ç§»åŠ¨åˆ°ä¸Šé¢
  transform: translateY(-100%);
  // å®Œå…¨é€æ˜
  opacity: 0;
  // æ˜¾ç¤ºå‡ºæ¥çš„ç±»å
  &.show {
    transition: all 0.3s linear;
    transform: none;
    opacity: 1;
  }
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    height: 80px;
    background: url("@/assets/images/logo.png") no-repeat right 2px;
    background-size: 160px auto;
  }
  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid @primaryColor;
    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;
      &:hover {
        color: @primaryColor;
      }
    }
  }
}
</style>

```

+ Layouté¦–é¡µå¼•å…¥å¸é¡¶å¯¼èˆªç»„ä»¶

```diff
<script setup lang="ts">
import AppTopnav from "./components/app-topnav.vue";
import AppHeader from "./components/app-header.vue";
import AppFooter from "./components/app-footer.vue";
+import AppHeaderSticky from "./components/app-header-sticky.vue";
import useStore from "@/store";
const { home } = useStore();
home.getAllCategory();
</script>

<template>
  <AppTopnav />
  <AppHeader />
+  <AppHeaderSticky />
+  <main class="app-body">
+    <!-- è·¯ç”±å‡ºå£ -->
+  </main>
  <AppFooter />
</template>

<style lang="less" scoped>
+.app-body {
+  min-height: 600px;
+}
</style>

```

### å¸é¡¶å®ç°

+ åœ¨æ»šåŠ¨åˆ° `78px` å®Œæˆæ˜¾ç¤ºæ•ˆæœï¼ˆæ·»åŠ ç±»åï¼‰

  > é€šè¿‡æ»šåŠ¨äº‹ä»¶çš„è§¦å‘ï¼Œåˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»æ»šåŠ¨äº† `78px`ï¼Œå¦‚æœå¤§äºåˆ™æ·»åŠ ç±»åï¼Œå¦åˆ™ç§»é™¤ç±»å
  >
  > 1. `document.documentElement.scrollTop`  è·å–æ»šåŠ¨è·ç¦»
  > 2. `:class`   åŠ¨æ€æ§åˆ¶ç±»åæ˜¾ç¤º

ç»„ä»¶`src/views/Layout/components/app-header-sticky.vue` 

```diff
<script setup lang="ts">
import AppHeaderNav from "./app-header-nav.vue";
+import { onMounted, onUnmounted, ref } from "vue";
+// æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå¸é¡¶ç»„ä»¶
+const isShow = ref(false);
+// è€ƒè™‘ä¼˜åŒ–ï¼Œç»„ä»¶æŒ‚è½½æ—¶ç»‘å®šäº‹ä»¶ï¼Œç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶
+const handlerScroll = () => {
+  const y = document.documentElement.scrollTop;
+  if (y >= 78) {
+    isShow.value = true;
+  } else {
+    isShow.value = false;
+  }
+};
+onMounted(() => {
+  window.addEventListener("scroll", handlerScroll);
+});
+onUnmounted(() => {
+  window.removeEventListener("scroll", handlerScroll);
+});
</script>

<template>
+  <div class="app-header-sticky" :class="{ show: isShow }">
    // ...
  </div>
</template>

```

## åˆ†ç±»å¯¼èˆªå¸é¡¶åŠŸèƒ½-é‡æ„

**ç›®æ ‡ï¼š** ä½¿ç”¨  `vueuse/core` é‡æ„å¸é¡¶åŠŸèƒ½

> `vueuse/core` : ç»„åˆå¼ `API` å¸¸ç”¨å¤ç”¨é€»è¾‘çš„é›†åˆ
>
> https://vueuse.org/core/useWindowScroll/

**æ ¸å¿ƒæ­¥éª¤**

1ï¼‰å®‰è£… `@vueuse/core` åŒ…ï¼Œå®ƒå°è£…äº†å¸¸è§çš„ä¸€äº›äº¤äº’é€»è¾‘

```bash
yarn add @vueuse/core
```

2ï¼‰åœ¨å¸é¡¶å¯¼èˆªä¸­ä½¿ç”¨

`src/components/app-header-sticky.vue` 

```vue
<script setup lang="ts">
import AppHeaderNav from './app-header-nav.vue'
import { useWindowScroll } from '@vueuse/core'
// æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå¸é¡¶ç»„ä»¶
const { y } = useWindowScroll()
</script>

<template>
  <div class="app-header-sticky" :class="{ show: y >= 78 }">
     // ...
  </div>
</template>
```

å¸¸è§ç–‘é—®ï¼š

- `vue2` é¡¹ç›®ä¸­èƒ½ä½¿ç”¨ `@vueuse/core`  å—ï¼Ÿ
  - å¯ä»¥ä½¿ç”¨ï¼Œéœ€é…åˆ  `@vue/composition-api` è®© `Vue2` è€é¡¹ç›®æ”¯æŒ **ç»„åˆå¼API**ã€‚
  - `@vueuse/core` åªèƒ½ä»¥ **ç»„åˆå¼API** å½¢å¼ä½¿ç”¨ã€‚



# é¦–é¡µ

## é…ç½®äºŒçº§è·¯ç”±

**ç›®æ ‡ï¼š**é…ç½®é¦–é¡µçš„è·¯ç”±ï¼Œé¦–é¡µ `Home` ç»„ä»¶å±äºäºŒçº§è·¯ç”±

**æ ¸å¿ƒæ­¥éª¤ï¼š**

+ åˆ›å»ºç»„ä»¶ `src/views/Home/index.vue`

```vue
<script setup lang="ts"></script>

<template>
  <div>Homeç»„ä»¶</div>
</template>

<style lang="less" scoped></style>

```

+ é…ç½®è·¯ç”±

```javascript
{
  path: '/',
  component: () => import('@/views/Layout/index.vue'),
  children: [
    {
      path: '/',
      component: () => import('@/views/Home/index.vue'),
    },
  ],
},
```

+ é…ç½®è·¯ç”±å‡ºå£

```vue
<main class="app-body">
  <!-- è·¯ç”±å‡ºå£ -->
  <RouterView />
</main>
```

## æ•´ä½“ç»„ä»¶æ‹†åˆ†

`ä»»åŠ¡ç›®æ ‡:`  ä»æ•´ä½“è§’åº¦æŒ‰ç…§æ¨¡å—åŠŸèƒ½è¿›è¡Œç»„ä»¶æ‹†åˆ†

1ï¼‰æ‹†åˆ†å·¦ä¾§åˆ†ç±»ç»„ä»¶

`Home/components/home-category.vue`

```html
<script setup lang="ts"></script>

<template>
  <div class="home-category">åˆ†ç±»ç»„ä»¶</div>
</template>

<style lang="less" scoped></style>

```

2ï¼‰æ‹†åˆ†bannerç»„ä»¶

`Home/components/home-banner.vue`

```html
<script setup lang="ts"></script>

<template>
  <div class="home-banner">banner</div>
</template>

<style scoped lang="less">
.home-banner {
  width: 1240px;
  height: 500px;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 98;
}
</style>

```

3ï¼‰homeç»„ä»¶ä¸­å¼•å…¥ä½¿ç”¨

```html
<script setup lang="ts">
import HomeBanner from "./components/home-banner.vue";
import HomeCategory from "./components/home-category.vue";
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
    </div>
  </div>
</template>

<style lang="less" scoped></style>

```

## å·¦ä¾§åˆ†ç±»å®ç°

![image-20210427151621526](media/left.png)

### 1. å¯¼èˆªmenuæ•°æ®æ¸²æŸ“

`Home/components/home-category.vue`

#### é™æ€ç»“æ„

```vue
<script setup lang="ts">
import { RouterLink } from 'vue-router';
</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="i in 9" :key="i">
        <RouterLink to="/">{{ 'å±…å®¶' }}</RouterLink>
        <RouterLink to="/">{{ 'èŒ¶å’–é…’å…·' }}</RouterLink>
        <RouterLink to="/">{{ 'æ°´å…·æ¯å£¶' }}</RouterLink>
        <!-- å¼¹å±‚layerä½ç½® -->
      </li>
    </ul>
  </div>
</template>

<style scoped lang="less">
.home-category {
  width: 250px;
  height: 500px;
  background: rgba(0, 0, 0, 0.8);
  position: relative;
  z-index: 99;
  .menu {
    li {
      padding-left: 40px;
      height: 55px;
      line-height: 55px;
      &:hover {
        background: @primaryColor;
      }
      a {
        margin-right: 4px;
        color: #fff;
        &:first-child {
          font-size: 16px;
        }
      }
      .layer {
        width: 990px;
        height: 500px;
        background: rgba(255, 255, 255, 1);
        position: absolute;
        left: 250px;
        top: 0;
        display: none;
        padding: 0 15px;
        h4 {
          font-size: 20px;
          font-weight: normal;
          line-height: 80px;
          small {
            font-size: 16px;
            color: #666;
          }
        }
        ul {
          display: flex;
          flex-wrap: wrap;
          li {
            width: 310px;
            height: 120px;
            margin-right: 15px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 4px;
            background: #fff;
            &:nth-child(3n) {
              margin-right: 0;
            }
            a {
              display: flex;
              width: 100%;
              height: 100%;
              align-items: center;
              padding: 10px;
              &:hover {
                background: #e3f9f4;
              }
              img {
                width: 95px;
                height: 95px;
              }
              .info {
                padding-left: 10px;
                line-height: 24px;
                overflow: hidden;
                .name {
                  font-size: 16px;
                  color: #666;
                }
                .desc {
                  color: #999;
                }
                .price {
                  font-size: 22px;
                  color: @priceColor;
                  i {
                    font-size: 16px;
                  }
                }
              }
            }
          }
        }
      }
      &:hover {
        .layer {
          display: block;
        }
      }
    }
  }
}
</style>

```

#### æ•°æ®æ¸²æŸ“ä¸€çº§åˆ†ç±»

```html
<script setup lang="ts">
import useStore from "@/store";
import { RouterLink } from "vue-router";
// è·å– Pinia ä¸­çš„ home æ¨¡å—ï¼Œåˆ†ç±»æ•°æ®ä¸º home.categoryList 
const { home } = useStore();
</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="item in home.categoryList" :key="item.id">
        <RouterLink to="/">{{ item.name }}</RouterLink>
        <RouterLink to="/">{{ "èŒ¶å’–é…’å…·" }}</RouterLink>
        <RouterLink to="/">{{ "æ°´å…·æ¯å£¶" }}</RouterLink>
        <!-- å¼¹å±‚layerä½ç½® -->
      </li>
    </ul>
  </div>
</template>

```

#### æ•°æ®æ¸²æŸ“äºŒçº§åˆ†ç±»

```vue
<script setup lang="ts">
import useStore from "@/store";
import { computed } from "vue";
import { RouterLink } from "vue-router";
// è·å– Pinia ä¸­çš„ home æ¨¡å—ï¼Œåˆ†ç±»æ•°æ®ä¸º home.categoryList 
const { home } = useStore();
// è®¡ç®—ï¼šå¤„ç†å·¦ä¾§åˆ†ç±»æ‰€éœ€çš„æ•°æ®æ ¼å¼
const leftCategoryList = computed(() => {
  // åŸºäº Pinia ä¸­çš„åˆ†ç±»æ•°æ®å¤„ç†
  return home.categoryList.map((item) => ({
    id: item.id,
    name: item.name,
    // åªéœ€è¦æˆªå–å‰ä¸¤ä¸ªäºŒçº§åˆ†ç±»
    children: item.children.slice(0, 2),
  }));
});
</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="item in leftCategoryList" :key="item.id">
        <RouterLink to="/">{{ item.name }}</RouterLink>
        <RouterLink v-for="item2 in item.children" :key="item2.id" to="/">
          {{ item2.name }}
        </RouterLink>
        <!-- å¼¹å±‚layerä½ç½® -->
      </li>
    </ul>
  </div>
</template>
```



### 2. é¼ æ ‡ç§»å…¥layerå±•ç¤º

**å®ç°æ­¥éª¤**

- å¸ƒå±€äº¤äº’
  - æ¯ä¸ªLiæ ‡ç­¾å¯¹åº”ä¸€ä¸ªè‡ªå·±çš„layerå¼¹å±‚ï¼Œé»˜è®¤å…¨éƒ¨éšè—
  - Li æ ‡ç­¾hoverçŠ¶æ€çš„æ—¶å€™è®©è‡ªå·±ä¸‹é¢çš„layerå¼¹å±‚å±•ç¤ºå‡ºæ¥
- æ•°æ®è·å–
  - æŠŠgoodså­—æ®µä¹Ÿå¯¼å…¥è¿›æ¥

**ä»£ç è½åœ°**

1ï¼‰å‡†å¤‡å¸ƒå±€

```html
<!-- å¼¹å±‚layerä½ç½® -->
<div class="layer">
  <h4>åˆ†ç±»æ¨è <small>æ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è</small></h4>
  <ul>
    <li v-for="i in 9" :key="i">
      <RouterLink to="/">
        <img src="https://yanxuan-item.nosdn.127.net/5a115da8f2f6489d8c71925de69fe7b8.png" alt="">
        <div class="info">
          <p class="name ellipsis-2">ã€å®šé‡‘è´­ã€‘ä¸¥é€‰é›¶é£Ÿå¤§ç¤¼åŒ…ï¼ˆ12ä»¶ï¼‰</p>
          <p class="desc ellipsis">è¶…å€¼ç»„åˆè£…ï¼Œæ»¡è¶³é¦‹å˜´æ¬²</p>
          <p class="price"><i>Â¥</i>100.00</p>
        </div>
      </RouterLink>
    </li>
  </ul>
</div>
```

2ï¼‰å¯¼å…¥æ–°å¢goodså­—æ®µ

```js
const list = computed(() => {
  return home.categoryList.map((item) => {
    return {
      id: item.id,
      name: item.name,
      children: item.children.slice(0, 2),
      // æ·»åŠ  goods å­—æ®µ
      goods: item.goods, 
    }
  })
})
```

3ï¼‰æ¸²æŸ“æ¨¡æ¿è§†å›¾

```html
<!-- å¼¹å±‚layerä½ç½® -->
<div class="layer">
  <h4>åˆ†ç±»æ¨è <small>æ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è</small></h4>
  <ul>
    <li v-for="goods in item.goods" :key="goods.id">
      <RouterLink to="/">
        <img :src="goods.picture" alt="" />
        <div class="info">
          <p class="name ellipsis-2">
            {{ goods.name }}
          </p>
          <p class="desc ellipsis">{{ goods.desc }}</p>
          <p class="price"><i>Â¥</i>{{ goods.price }}</p>
        </div>
      </RouterLink>
    </li>
  </ul>
</div>
```

## `XtxUI` ç»„ä»¶åº“

### åŸºæœ¬ä½¿ç”¨

**ä»»åŠ¡ç›®æ ‡:**  æŠŠç»„ä»¶åº“ä»ç´ ææ–‡ä»¶å¤¹ï¼Œå¤åˆ¶åˆ°é¡¹ç›®ä¸­ä½¿ç”¨ã€‚

**æ ¸å¿ƒæ­¥éª¤ï¼š**

1. å¤åˆ¶ç´ æä¸­çš„ `components`æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰ `XtxUI` ç»„ä»¶ï¼Œæ”¾åˆ° `src/components` ä¸­ã€‚
2. `yarn lint`  æˆ– `npm run lint` æ ¼å¼åŒ–æ–‡ä»¶ã€‚
3. ä½¿ç”¨ç»„ä»¶åº“æä¾›çš„ç»„ä»¶ã€‚

æ–°å»ºæµ‹è¯•é¡µé¢ï¼š`src\views\Test\index.vue` 

```vue
<script setup lang="ts">
// ç›´æ¥å¯¼å…¥ vue ç»„ä»¶æºæ–‡ä»¶ï¼Œå¯¼å…¥å¤šä¸ªç»„ä»¶éœ€è¦å†™å¤šä¸ª import
import Button from "@/components/XtxUI/Button/index.vue";
import Skeleton from "@/components/XtxUI/Skeleton/Skeleton.vue";
</script>

<template>
  <!-- é—®é¢˜è§£ç­”1ï¼šåœ¨æ¨¡æ¿ä¸­å¯ä»¥è‡ªåŠ¨å¯¼å…¥ .vue åç¼€åçš„æºæ–‡ä»¶ -->
  <Button type="primary" size="large">æŒ‰é’®</Button>
  <!-- ç›´æ¥å¯¼å…¥çš„ç»„ä»¶æ”¯æŒ TS ç±»å‹æ£€æŸ¥ï¼Œé¼ æ ‡æ‚¬åœæµ‹è¯• -->
  <Skeleton :height="30" :width="100" bg="pink" />
</template>

```

### å±€éƒ¨æ³¨å†Œç»„ä»¶

**ä»»åŠ¡ç›®æ ‡:**  ç»„ä»¶åº“ä¸­å°è£…äº†ç»Ÿä¸€å‡ºå£ï¼Œä¿®æ”¹å¯¼å…¥ç»„ä»¶åº“ç»„ä»¶çš„æ–¹å¼ã€‚

```diff
<script setup lang="ts">
-// ç›´æ¥å¯¼å…¥ç»„ä»¶æºæ–‡ä»¶ï¼Œå¯¼å…¥å¤šä¸ªç»„ä»¶éœ€è¦å†™å¤šä¸ª import
-import Button from "@/components/XtxUI/Button/index.vue";
-import Skeleton from "@/components/XtxUI/Skeleton/Skeleton.vue";
+// åŒä¸€ä¸ª import å¯ä»¥åŒæ—¶å¯¼å…¥å¤šä¸ªç»„ä»¶
+import { XtxSkeleton, XtxButton } from "@/components/XtxUI";
</script>

<template>
-  <Button type="primary" size="large">æŒ‰é’®</Button>
-  <Skeleton :height="30" :width="100" bg="pink" />
+  <!-- é¼ æ ‡æ‚¬åœæ£€æŸ¥ TS ç±»å‹ -->
+  <XtxButton type="primary" size="large">æŒ‰é’®</XtxButton>
+  <XtxSkeleton :height="30" :width="100" bg="pink" />
</template>
```



### å…¨å±€æ³¨å†Œç»„ä»¶

**ä»»åŠ¡ç›®æ ‡ï¼š**ä»¥æ’ä»¶çš„å½¢å¼æ³¨å†Œå…¨å±€ç»„ä»¶

**æ ¸å¿ƒæ­¥éª¤**ï¼š

1. æ–°å»ºæ–‡ä»¶`components/index.ts`

```tsx
import type { App, Plugin } from 'vue'
import Skeleton from './Skeleton/Skeleton.vue'

const XtxUI: Plugin = {
  install(app: App) {
    app.component(`XtxSkeleton`, Skeleton);
  },
};

export default XtxUI;

```

2. åœ¨`main.ts`ä¸­å…¨å±€æ³¨å†Œ

```tsx
import XtxUI from "./components/XtxUI";

const app = createApp(App)
app.use(XtxUI)
```

3. åœ¨é¡µé¢ä¸­ä½¿ç”¨ã€‚

```diff
<script setup lang="ts">
-import { XtxSkeleton, XtxButton } from "@/components/XtxUI/index";
</script>

<template>
+  <!-- ğŸ›é—®é¢˜ï¼šé¼ æ ‡æ‚¬åœä¸º anyï¼Œå¤±å» TS ç±»å‹æ£€æŸ¥ -->
  <XtxButton type="primary" size="large">æŒ‰é’®</XtxButton>
  <XtxSkeleton :height="30" :width="100" bg="pink" />
</template>
```

- ğŸ›é—®é¢˜ï¼šå…¨å±€ç»„ä»¶æ³¨å†ŒæˆåŠŸï¼Œä½†æ˜¯è°ƒç”¨æ—¶æ²¡æœ‰ TS ç±»å‹æç¤ºã€‚

- è§£å†³æ–¹æ¡ˆï¼šä¸ºç»„ä»¶åº“åˆ›å»ºå¯¹åº”çš„ç±»å‹å£°æ˜æ–‡ä»¶ã€‚

### å…¨å±€ç»„ä»¶ TS ç±»å‹å£°æ˜æ–‡ä»¶ğŸš¨ 

**ä»»åŠ¡ç›®æ ‡ï¼š** ä¸ºå…¨å±€ç»„ä»¶ä¹¦å†™å¯¹åº”çš„ TS ç±»å‹å£°æ˜æ–‡ä»¶ã€‚

- ç”¨æ³•å‚è€ƒï¼š`element-plus` æºç  [Element-Plus æºç é“¾æ¥](https://github.com/element-plus/element-plus/blob/dev/global.d.ts)

- `Volar` æ’ä»¶è¯´æ˜ï¼š[Volar æ’ä»¶è¯´æ˜](https://github.com/johnsoncodehk/volar/blob/master/extensions/vscode-vue-language-features/README.md)

æ–°å»ºç±»å‹å£°æ˜æ–‡ä»¶ï¼š `src\components\XtxUI\global.d.ts` ï¼Œå‡†å¤‡åŸºæœ¬ç»“æ„

```js
// å…¨å±€ç»„ä»¶ç±»å‹å£°æ˜æ–‡ä»¶ for Volar
declare module 'vue' {
  // å…¨å±€ç»„ä»¶éœ€è¦å®šä¹‰ interface GlobalComponents
  export interface GlobalComponents { 
     å…¨å±€ç»„ä»¶å: ç»„ä»¶ç±»å‹;
  }
}

export { }
```

æ·»åŠ å…¨å±€ç»„ä»¶ç±»å‹å£°æ˜ï¼š

```diff
+// å¯¼å…¥ .vue æºæ–‡ä»¶
+import Button from "./Button/index.vue";
+import Skeleton from "./Skeleton/Skeleton.vue";

// å…¨å±€ç»„ä»¶ç±»å‹å£°æ˜æ–‡ä»¶ for Volar
declare module "vue" {
  // å…¨å±€ç»„ä»¶éœ€è¦å®šä¹‰ interface GlobalComponents
  export interface GlobalComponents {
+    // typeof è·å– TS ç±»å‹
+    XtxButton: typeof Button;
+    XtxSkeleton: typeof Skeleton;
  }
}

export {};
```



## éª¨æ¶ç»„ä»¶

### åŸºæœ¬ä½¿ç”¨

**ä»»åŠ¡ç›®æ ‡:**  åœ¨åˆ†ç±»æ¨¡å—ä¸­ä½¿ç”¨æˆ‘ä»¬å®šä¹‰å¥½çš„éª¨æ¶ç»„ä»¶å¢å¼ºç”¨æˆ·ä½“éªŒ

**æ ¸å¿ƒæ­¥éª¤ï¼š**

1. æµ‹è¯• `XtxSkeleton` çš„ä½¿ç”¨

```vue
<template>
  <div>
    <XtxSkeleton :width="400" :height="300" bg="pink" />
    <XtxSkeleton :width="400" :height="300" bg="#000" />
  </div>
</template>
```

### åˆ†ç±»ä¼˜åŒ–

**ä»»åŠ¡ç›®æ ‡ï¼š**èƒ½å¤Ÿä½¿ç”¨éª¨æ¶ç»„ä»¶ä¼˜åŒ–é¦–é¡µçš„åˆ†ç±»å±•ç¤º

**æ ¸å¿ƒæ­¥éª¤**

1. åœ¨`Home/components/home-category.vue`ä¸­ä¼˜åŒ–å·¦ä¾§åˆ†ç±»çš„å±•ç¤º

```vue
<div class="home-category">
  <!-- åˆ†ç±»æ•°æ®å±•ç¤º v-if -->
  <ul class="menu" v-if="leftCategoryList.length > 0">
     // å·¦ä¾§åˆ†ç±»
  </ul>
  <!-- åˆ†ç±»å ä½æ•ˆæœ v-else äº’æ–¥ -->
  <ul class="menu" v-else>
    <li v-for="i in 9" :key="i">
      <XtxSkeleton
        :width="40"
        :height="20"
        style="margin-right: 5px"
        bg="rgba(255,255,255,0.2)"
      />
      <XtxSkeleton
        :width="50"
        :height="20"
        bg="rgba(255,255,255,0.2)"
        style="margin-right: 5px"
      />
      <XtxSkeleton :width="50" :height="20" bg="rgba(255,255,255,0.2)" />
    </li>
  </ul>
</div>
```

2. åœ¨`Layout/components/app-header-nav.vue`ä¸­ä¼˜åŒ–å¤´éƒ¨å¯¼èˆªçš„å±•ç¤º

```tsx
<ul class="app-header-nav">
  <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
  <template v-if="home.categoryList.length > 0">
    <li v-for="item in home.categoryList" :key="item.id">
      <a href="#">{{ item.name }}</a>
    </li>
  </template>
  <template v-else>
    <li v-for="i in 9" :key="i">
      <XtxSkeleton
        :width="60"
        :height="32"
        style="margin-right: 5px"
        bg="rgba(0,0,0,0.2)"
      />
    </li>
  </template>
</ul>
```

**æ³¨æ„ï¼š**

-  v-if å’Œ v-for æŒ‡ä»¤åœ¨ `Vue2` å’Œ `Vue3` çš„æƒ…å†µä¸åŒï¼Œ

- `Vue3` ä¸­ `v-if` çš„ä¼˜å…ˆçº§æ¯” `v-for` æ›´é«˜
-  **ä¸**æ¨èåœ¨åŒä¸€å…ƒç´ ä¸Šä½¿ç”¨ `v-if` å’Œ `v-for`ï¼Œå»ºè®®é…åˆ`template` æ ‡ç­¾è¿›è¡Œå¤„ç†ã€‚[å‚è€ƒèµ„æ–™](https://v3.cn.vuejs.org/guide/list.html#v-for-%E4%B8%8E-v-if-%E4%B8%80%E5%90%8C%E4%BD%BF%E7%94%A8)

## è½®æ’­å›¾åŠŸèƒ½

### è·å–æ•°æ®

**ä»»åŠ¡ç›®æ ‡**:  åŸºäº `pinia` è·å–è½®æ’­å›¾æ•°æ®

**æ ¸å¿ƒä»£ç ï¼š**

1. åœ¨`store/modules/home.ts`æ–‡ä»¶ä¸­å°è£…æ¥å£ï¼Œè·å–è½®æ’­å›¾æ•°æ®

```ts
const useHomeStore = defineStore('home', {
  actions: {
    // ...
    // è·å–è½®æ’­å›¾æ•°æ®
    async getBannerList() {
      const res = await http('GET', '/home/banner');
      console.log('/home/banner', res);
    },
  }
})

export default useHomeStore

```
2. åœ¨ç»„ä»¶ä¸­å‘é€è¯·æ±‚`Home/components/home-banner.vue`

```tsx
<script setup lang="ts">
import useStore from '@/store'

const { home } = useStore()
home.getBannerList()
</script>
```

3. æ ¹æ®è¯·æ±‚è¿”å›çš„æ•°æ®ï¼Œåœ¨`src\types\api\home.d.ts` æ–‡ä»¶ä¸­å®šä¹‰å¯¹åº”çš„ TS ç±»å‹å£°æ˜ã€‚

```ts
// è½®æ’­å›¾ç±»å‹
export interface Banner {
  id: string;
  imgUrl: string;
  hrefUrl: string;
  type: string;
}

export type BannerList = Banner[];

```

4. åœ¨`store/modules/home.ts`æ–‡ä»¶ä¸­ï¼Œå®Œå–„ TS ç±»å‹å£°æ˜ã€‚

```diff
-import type { CategoryList } from '@/types'
+import type { CategoryList, BannerList } from '@/types'
const useHomeStore = defineStore('home', {
  state: () => ({
    // ...
    // è½®æ’­å›¾æ•°æ®
+    bannerList: [] as BannerList
  }),
  actions: {
    // ...
    // è·å–è½®æ’­å›¾æ•°æ®
    async getBannerList() {
-      const res = await http("GET", "/home/banner");
+      const res = await http<BannerList>("GET", "/home/banner");
+      this.bannerList = res.data.result;
    },
  }
})

export default useHomeStore

```


### æ¸²æŸ“è½®æ’­å›¾(å¿«é€Ÿå®ç°)

**ä»»åŠ¡ç›®æ ‡ï¼š**åŸºäºå°è£…å¥½çš„è½®æ’­å›¾ç»„ä»¶å¿«é€Ÿå®ç° Banner æ¨¡å—

3. åœ¨Bannerç»„ä»¶ä¸­ä½¿ç”¨`Home/components/home-banner.vue`

```diff
<script setup lang="ts">
import useStore from "@/store";
const { home } = useStore();
home.getBannerList();
</script>

<template>
  <div class="home-banner">
+    <XtxSlider :sliders="home.bannerList" auto-play />
  </div>
</template>
```

## é¦–é¡µä¸»ä½“-é¢æ¿ç»„ä»¶å°è£…

> æ–°é²œå¥½ç‰©ã€äººæ°”æ¨èä¿©ä¸ªæ¨¡å—çš„å¸ƒå±€ç»“æ„ä¸Šéå¸¸ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½ç¦»å‡ºä¸€ä¸ªé€šç”¨çš„é¢æ¿ç»„ä»¶æ¥è¿›è¡Œå¤ç”¨

**ä»»åŠ¡ç›®æ ‡**:  å°è£…ä¸€ä¸ªé€šç”¨çš„é¢æ¿ç»„ä»¶ã€‚

![](media/panel.png)

**æ€è·¯åˆ†æ**

1. å›¾ä¸­æ ‡å‡ºçš„å››ä¸ªéƒ¨åˆ†éƒ½æ˜¯å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œéœ€è¦æˆ‘ä»¬å®šä¹‰ä¸ºå¯é…ç½®
2. ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ç”±äºæ˜¯çº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬å®šä¹‰æˆ props å³å¯
3. å³ä¾§å†…å®¹å’Œä¸»ä½“å†…å®¹ç”±äºå¯èƒ½ä¼šä¼ å…¥è¾ƒä¸ºå¤æ‚çš„è‡ªå®šä¹‰æ¨¡æ¿ï¼Œæˆ‘ä»¬å®šä¹‰æˆ slot åˆ©ç”¨æ’æ§½æ¸²æŸ“

**æ ¸å¿ƒä»£ç **

+ ç»„ä»¶ç¼–å†™

`Home/components/home-panel.vue`

```html
<script setup lang="ts">
defineProps<{
  title: string;
  subTitle?: string;
}>();
</script>

<template>
  <div class="home-panel">
    <div class="container">
      <div class="head">
        <h3>
          {{ title }}<small>{{ subTitle }}</small>
        </h3>
        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <slot name="right"></slot>
      </div>
      <!-- ä¸»ä½“å†…å®¹åŒºåŸŸ -->
      <slot></slot>
    </div>
  </div>
</template>

<style scoped lang="less">
.home-panel {
  background-color: #fff;
  .head {
    padding: 40px 0;
    display: flex;
    align-items: flex-end;
    h3 {
      flex: 1;
      font-size: 32px;
      font-weight: normal;
      margin-left: 6px;
      height: 35px;
      line-height: 35px;
      small {
        font-size: 16px;
        color: #999;
        margin-left: 20px;
      }
    }
  }
}
</style>

```

+ ä½¿ç”¨home-pannelç»„ä»¶`Home/index.vue`

```html
<script setup lang="ts">
import HomeBanner from './components/home-banner.vue';
import HomeCategory from './components/home-category.vue';
import HomePanel from './components/home-panel.vue';
</script>

<template>
  <div class="page-home">
    <!-- é¦–å± -->
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
    </div>
    <!-- æ¥¼å±‚é¢æ¿ç»„ä»¶å’Œ home-entry åŒçº§ -->
    <HomePanel title="å¤§æ ‡é¢˜" sub-title="å‰¯æ ‡é¢˜">
      <template #right>
        <XtxMore />
      </template>
      <h2>æˆ‘æ˜¯ä¸»ä½“å†…å®¹-é»˜è®¤æ’æ§½</h2>
    </HomePanel>
  </div>
</template>

<style lang="less" scoped></style>

```

## é¦–é¡µä¸»ä½“-æ–°é²œå¥½ç‰©

> ç›®æ ‡ï¼šå°è£…ä¸€ä¸ªæ–°é²œå¥½ç‰©çš„ç»„ä»¶ï¼Œç”¨äºå¤„ç†æ–°é²œå¥½ç‰©æ¨¡å—ã€‚

1. åˆ›å»ºç»„ä»¶ï¼Œå‡†å¤‡é™æ€ç»“æ„ `Home/components/home-new.vue`

```vue
<script setup lang="ts">
import HomePanel from './home-panel.vue'
</script>

<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/" /></template>
      <!-- é¢æ¿å†…å®¹ -->
      <ul class="goods-list">
        <li v-for="item in 4" :key="item">
          <RouterLink to="/">
            <img
              src="https://yanxuan-item.nosdn.127.net/e7337596de7161c57c27e8d8040231aa.jpg"
              alt=""
            />
            <p class="name ellipsis">æƒ…ä¾£æ¬¾æ—¶å°šæˆ·å¤–è½»å‹å¾’æ­¥é‹ç¯ä¿å¤§åº•</p>
            <p class="price">&yen;364.00</p>
          </RouterLink>
        </li>
      </ul>
    </HomePanel>
  </div>
</template>

<style scoped lang="less">
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 406px;
  li {
    width: 306px;
    height: 406px;
    background: #f0f9f4;
    .hoverShadow();
    img {
      width: 306px;
      height: 306px;
    }
    p {
      font-size: 22px;
      padding: 12px 30px 0 30px;
      text-align: center;
    }
    .price {
      color: @priceColor;
    }
  }
}
</style>

```

2. ä¿®æ”¹ `src\views\Home\index.vue` ï¼Œå¼•å…¥å¹¶ä½¿ç”¨ç»„ä»¶ã€‚

```vue
<script setup lang="ts">
import HomeNew from './components/home-new.vue'
</script>

<template>
  <div class="page-home">
    <!-- å·¦ä¾§åˆ†ç±»å’Œè½®æ’­å›¾ -->
    <div class="home-entry">
      ...
    </div>
    <!-- é¢æ¿ç»„ä»¶ å’Œ home-entry åŒçº§ -->
    <HomeNew />
  </div>
</template>
```

3. åœ¨`store/modules/home.ts`æ–‡ä»¶ä¸­å°è£…è¯·æ±‚

```ts
// ...
const useHomeStore = defineStore('home', {
  // ...
  actions: {
    // ...
    async getNewGoodsList() {
      const res = await http('GET', '/home/new');
      console.log('/home/new', res);
    }
  }
})

```

4. åœ¨ `Home\components\home-new.vue`  ç»„ä»¶ä¸­ï¼Œè°ƒç”¨ actions è·å–æ•°æ®

```vue
<script setup lang="ts">
import HomePanel from './home-panel.vue'
import useStore from '@/store'
const { home } = useStore()
home.getNewGoodsList()
</script>
```

4. å®Œå–„ç±»å‹å£°æ˜æ–‡ä»¶ï¼ˆå•†å“ç±»å‹å¯å¤ç”¨ï¼‰

```ts
// ğŸ””ç”µå•†ç½‘ç«™å•†å“çš„ç±»å‹åŸºæœ¬ä¸€è‡´ï¼Œå¯ä»¥å¤ç”¨
export interface Goods {
  id: string;
  name: string;
  desc: string;
  price: string;
  picture: string;
  orderNum: number;
}

// å•†å“åˆ—è¡¨ç±»å‹(å¯ä»¥å¤ç”¨)
export type GoodsList = Goods[];
```

5. å®Œå–„ `store/modules/home.ts` æ–‡ä»¶ä¸­çš„ç±»å‹

```diff
import { defineStore } from 'pinia'
import { http } from '@/utils/request'
-import type { CategoryList, BannerList } from '@/types'
+import type { CategoryList, BannerList, GoodsList } from '@/types'
const useHomeStore = defineStore('home', {
  state: () => ({
     // ...
+    newGoodsList: [] as GoodsList
  }),
  actions: {
    // ...
    async getNewGoodsList() {
-      const res = await http("GET", "/home/new");
+      const res = await http<GoodsList>("GET", "/home/new");
+      this.newGoodsList = res.data.result
    }
  }
})

export default useHomeStore

```

6. åœ¨ `Home\components\home-new.vue` ç»„ä»¶ä¸­ï¼Œå®Œæˆåˆ—è¡¨æ¸²æŸ“

```vue
<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/" /></template>
      <!-- é¢æ¿å†…å®¹ -->
      <ul class="goods-list">
        <li v-for="item in home.newGoodsList" :key="item.id">
          <RouterLink to="/">
            <img :src="item.picture" alt="" />
            <p class="name ellipsis">{{ item.name }}</p>
            <p class="price">&yen;{{ item.price }}</p>
          </RouterLink>
        </li>
      </ul>
    </HomePanel>
  </div>
</template>
```

## é¦–é¡µä¸»ä½“-äººæ°”æ¨èï¼ˆè¯¾åä½œä¸šï¼‰

> æ¸©é¦¨æç¤ºï¼šäººæ°”æ¨èçš„é€»è¾‘å’Œæ–°é²œå¥½ç‰©çš„é€»è¾‘åŸºæœ¬ä¸€è‡´

ï¼ˆ1ï¼‰å‘é€è¯·æ±‚ï¼Œè·å–æ•°æ® `src/store/modules/home.ts`

```diff
const useHomeStore = defineStore('home', {
  state: () => ({
+    hotGoodsList: [] as GoodsList
  }),
  actions: {
+    async getHotGoodsList() {
+      const res = await http<GoodsList>("GET", "/home/hot");
+      this.hotGoodsList = res.data.result
+    }
  }
})

```

ï¼ˆ2ï¼‰åˆ›å»ºç»„ä»¶`Home/components/home-hot.vue`

```vue
<script setup lang="ts">
import useStore from '@/store';
import HomePanel from './home-panel.vue';
import { useObserver } from '@/hooks';

const { home } = useStore();
const { target } = useObserver(home.getHotGoodsList);
</script>

<template>
  <div class="home-hot" ref="target">
    <HomePanel title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
      <ul class="goods-list">
        <li v-for="item in home.hotGoodsList" :key="item.id">
          <RouterLink to="/">
            <img :src="item.picture" alt="" />
            <p class="name">{{ item.title }}</p>
            <p class="desc">{{ item.alt }}</p>
          </RouterLink>
        </li>
      </ul>
    </HomePanel>
  </div>
</template>

<style scoped lang="less">
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 426px;
  li {
    width: 306px;
    height: 406px;
    .hoverShadow();
    img {
      width: 306px;
      height: 306px;
    }
    p {
      font-size: 22px;
      padding-top: 12px;
      text-align: center;
    }
    .desc {
      color: #999;
      font-size: 18px;
    }
  }
}
</style>

```

ï¼ˆ3ï¼‰é¦–é¡µä¸­æ¸²æŸ“`src/views/home/index.vue`

```vue
<script setup lang="ts">
import HomeBanner from './components/home-banner.vue'
import HomeCategory from './components/home-category.vue'
import HomeNew from './components/home-new.vue'
import HomeHot from './components/home-hot.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
      <!-- æ–°é²œå¥½ç‰© -->
      <HomeNew />
      <!-- äººæ°”æ¨è -->
      <HomeHot />
    </div>
  </div>
</template>

<style lang="less" scoped></style>

```

## æŒ‰éœ€è¯·æ±‚(è¯·æ±‚æ‡’åŠ è½½)ğŸš¨ğŸš¨

ç”µå•†é¡¹ç›®æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯æ‰‹æ®µï¼šç»„ä»¶æ•°æ®æ‡’åŠ è½½  ï¼ˆé¦–å±æ¸²æŸ“ä¼˜åŒ–ï¼‰

è¯´æ˜ï¼šç”µå•†ç±»ç½‘ç«™çš„é¦–é¡µå†…å®¹ä¼šæœ‰å¥½å‡ å±ï¼Œå¦‚æœç›´æ¥åŠ è½½å¹¶æ¸²æŸ“æ‰€æœ‰å±çš„æ•°æ®ï¼Œä¼šæ¯”è¾ƒæµªè´¹æ€§èƒ½ã€‚

ä¼˜åŒ–ï¼šåº”è¯¥ **`å½“æ¨¡å—è¿›å…¥åˆ° å¯è§†åŒº ï¼Œå†å‘è¯·æ±‚è·å–æ•°æ®`**ã€‚

### æ£€æµ‹ç›®æ ‡å…ƒç´ çš„å¯è§æ€§ 

`ä»»åŠ¡ç›®æ ‡:`  äº†è§£å¦‚ä½•æ£€æµ‹ç›®æ ‡å…ƒç´ çš„å¯è§æ€§ 

**æŠ€æœ¯æ–¹æ¡ˆï¼š**

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `@vueuse/core` ä¸­çš„ `useIntersectionObserver` æ¥å®ç°ç›‘å¬ç»„ä»¶è¿›å…¥å¯è§†åŒºåŸŸè¡Œä¸ºï¼Œ

éœ€è¦é…åˆ `vue3` çš„ç»„åˆ `API` çš„æ–¹å¼æ‰èƒ½å®ç°

https://vueuse.org/core/useIntersectionObserver/

å…ˆåˆ†æä¸‹è¿™ä¸ª`useIntersectionObserver` å‡½æ•°ï¼š

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { useIntersectionObserver } from '@vueuse/core';

// ğŸ””æ ¸å¿ƒå•è¯è§£é‡Šï¼š
//   useIntersectionObserver   æ£€æŸ¥å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºå‡½æ•°
//   target                    ç›®æ ‡å…ƒç´ ï¼ŒğŸ¯éœ€é…åˆæ¨¡æ¿ ref ä½¿ç”¨
//   isIntersecting            æ˜¯å¦è¿›å…¥å¯è§†åŒº(å¸ƒå°”å€¼)
//   stop                      ç”¨äºåœæ­¢æ£€æµ‹çš„å‡½æ•°

// å‡†å¤‡ç›®æ ‡å…ƒç´ (DOMèŠ‚ç‚¹æˆ–ç»„ä»¶ï¼Œéœ€é…åˆæ¨¡æ¿ ref ä½¿ç”¨)
const target = ref(null);

const { stop } = useIntersectionObserver(target, ([{ isIntersecting }]) => {
  console.log('æ£€æµ‹å…ƒç´ å¯è§æ€§', isIntersecting);
  // éœ€æ±‚ï¼šå¦‚æœç›®æ ‡å…ƒç´ è¿›å…¥å¯è§†åŒºï¼Œå°±å‘é€è¯·æ±‚ï¼Œå¹¶åœæ­¢æ£€æµ‹
  if (isIntersecting) {
    // å½“ç›®æ ‡å…ƒç´ è¿›å…¥å¯è§†åŒºåŸŸæ—¶ï¼Œæ‰å‘é€è¯·æ±‚
    console.log('è¿›å…¥å¯è§†åŒºï¼Œéœ€è¦å‘é€è¯·æ±‚');
    // è¯·æ±‚å·²å‘é€ï¼Œä¸»åŠ¨åœæ­¢æ£€æŸ¥
    stop();
  }
});
</script>

<template>
  <div style="height: 2000px"></div>
  <!-- ğŸ¯ç›®æ ‡å…ƒç´ éœ€æ·»åŠ æ¨¡æ¿ ref  -->
  <div ref="target">
    <h1>ğŸ¯æˆ‘æ˜¯ç›®æ ‡å…ƒç´ ğŸ¯</h1>
  </div>
  <div style="height: 2000px"></div>
</template>

```

æˆ‘ä»¬ä»¥æ–°é²œå¥½ç‰©æ¨¡å—ä¸ºä¾‹æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨æ–¹å¼

1ï¼‰é€šè¿‡ `ref` å±æ€§è·å¾—ç»„ä»¶å®ä¾‹å¹¶æµ‹è¯•

2ï¼‰ä½¿ç”¨`useIntersectionObserver`ç›‘å¬å‡½æ•°

```html
<script setup lang="ts">
import HomePanel from "./home-panel.vue";
import { ref } from "vue";
import { useIntersectionObserver } from "@vueuse/core";
import useStore from "@/store";
const { home } = useStore();
// é€šè¿‡ ref è·å¾—ç»„ä»¶å®ä¾‹
const target = ref(null);
const { stop } = useIntersectionObserver(
  // target è¢«æ£€æµ‹çš„ç›®æ ‡å…ƒç´ 
  target,
  // isIntersecting æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ
  ([{ isIntersecting }]) => {
    // åœ¨æ­¤å¤„å¯æ ¹æ®isIntersectingæ¥åˆ¤æ–­ï¼Œç„¶ååšä¸šåŠ¡
    console.log('æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ', isIntersecting);
    if (isIntersecting) {
      home.getHotGoodsList();
      stop();
    }
  }
);
</script>

<template>
  <div class="home-hot">
    <!-- ğŸš¨ æ·»åŠ  ref="target" å’Œ æ¨¡æ¿å…³è” -->
    <HomePanel ref="target" title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
      ...
    </HomePanel>
  </div>
</template>
```

3ï¼‰æµ‹è¯•æ•ˆæœ

æ‰“å¼€æµè§ˆå™¨ï¼Œäººæ°”æ¨èæ¨¡å—è¿˜æœªè¿›å…¥åˆ°å¯è§†åŒºï¼Œæ‰“å°å€¼ä¸ºfalseï¼Œ

ç„¶åæˆ‘ä»¬æ»‘åŠ¨é¡µé¢ï¼Œå½“`äººæ°”æ¨¡å—`ç»„ä»¶è¿›å…¥å¯è§†åŒºä¸­æ—¶ï¼Œå†æ¬¡å‘ç”Ÿæ‰“å°ï¼Œæ­¤æ—¶ä¸ºtrueï¼Œ

åˆ°æ­¤æˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ç»„ä»¶è¿›å…¥å’Œç¦»å¼€å¯è§†åŒºäº†

**ç‰¹åˆ«æ³¨æ„ï¼š**æ¯æ¬¡è¢«ç›‘å¬çš„domè¿›å…¥ç¦»å¼€å¯è§†åŒºæ—¶éƒ½ä¼šè§¦å‘ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯åªè§¦å‘ä¸€æ¬¡ï¼Œ å¯ä»¥stopå…³é—­ç›‘å¬

### å…·ä½“ä¸šåŠ¡å®ç°

`ä»»åŠ¡ç›®æ ‡:`  åˆ©ç”¨æˆ‘ä»¬æ‹æ¸…æ¥šçš„å‘é€è¯·æ±‚çš„ä½ç½®å®ç°ä¸šåŠ¡æ•°æ®æ‹‰å–å®Œæˆå®é™…ä¸šåŠ¡åŠŸèƒ½

**å®ç°æ­¥éª¤**

1. å‘é€çš„ajaxè¯·æ±‚åœ¨`isIntersecting` ä¸ºtrueæ—¶è§¦å‘
2. ä¸€æ—¦è§¦å‘ä¸€æ¬¡ä¹‹ååœæ­¢ç›‘å¬ï¼Œé˜²æ­¢æ¥å£é‡å¤è°ƒç”¨

**ä»£ç è½åœ°**

```html
<script setup lang="ts">
 // ...çœç•¥
</script>



<!-- ğŸš¨ æ·»åŠ  ref="target" å’Œ æ¨¡æ¿å…³è” -->
<HomePanel ref="target" title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">...</HomePanel>
```



### ç»„ä»¶æ•°æ®æ‡’åŠ è½½é€»è¾‘å¤ç”¨

`æœ¬èŠ‚ç›®æ ‡:`  æŠ½ç¦»ç»„ä»¶æ•°æ®æ‡’åŠ è½½å¯å¤ç”¨çš„é€»è¾‘

#### ç°å­˜é—®é¢˜

> é¦–é¡µä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½åº”è¯¥ä½¿ç”¨ç»„ä»¶æ•°æ®æ‡’åŠ è½½è¿™ä¸ªåŠŸèƒ½ï¼Œä¸ç®¡æ˜¯å“ªä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä¸‹é¢ä»£ç éƒ½ä¼šé‡å¤ä¹¦å†™
>
> äº‹å®ä¸Šï¼Œå”¯ä¸€å¯èƒ½ä¼šéšç€ä¸šåŠ¡ä½¿ç”¨å‘ç”Ÿå˜åŒ–çš„æ˜¯ ajaxæ¥å£çš„è°ƒç”¨
>
> å…¶ä½™çš„éƒ¨åˆ†æˆ‘ä»¬è¿›è¡Œé‡å¤ä½¿ç”¨ï¼ŒæŠ½ç¦»ä¸ºå¯å¤ç”¨é€»è¾‘

![](media/cma1.png)

#### æŠ½ç¦»é€šç”¨é€»è¾‘

1ï¼‰æŠ½ç¦»é€»è¾‘

`src/hooks/index.ts`

```js
import { useIntersectionObserver } from "@vueuse/core";
import { ref } from "vue";

/**
 * è¯·æ±‚æŒ‰éœ€åŠ è½½
 * @param apiFn å‘é€è¯·æ±‚å‡½æ•°
 * @returns  ğŸš¨ target ç”¨äºæ¨¡æ¿ç»‘å®š
 */
export const useObserver = (apiFn: () => void) => {
  // å‡†å¤‡ä¸ª ref ç”¨äºç»‘å®šæ¨¡æ¿ä¸­çš„æŸä¸ªç›®æ ‡å…ƒç´ (DOMèŠ‚ç‚¹æˆ–ç»„ä»¶)
  const target = ref(null);
  const { stop } = useIntersectionObserver(target, ([{ isIntersecting }]) => {
    console.log("æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ", isIntersecting);
    if (isIntersecting) {
      // å½“ç›®æ ‡å…ƒç´ è¿›å…¥å¯è§†åŒºåŸŸæ—¶ï¼Œæ‰å‘é€è¯·æ±‚
      apiFn();
      // è¯·æ±‚å·²å‘é€ï¼Œä¸»åŠ¨åœæ­¢æ£€æŸ¥
      stop();
    }
  });
  // ğŸš¨è¿”å› ref ç”¨äºæ¨¡æ¿ç»‘å®šï¼Œå»ºè®®è¿”å›å¯¹è±¡æ ¼å¼æ”¯æŒè§£æ„è·å–
  return { target };
};

```

2ï¼‰ä¸šåŠ¡æ”¹å†™

```diff
<script setup lang="ts">
import { RouterLink } from "vue-router";
import useStore from "@/store";
import HomePanel from "./home-panel.vue";
+ import { useObserver } from "@/hooks";
const { home } = useStore();
+ const { target } = useObserver(home.getHotGoodsList);
</script>
```

éª¨æ¶ç»„ä»¶ - ä¼˜åŒ–é»˜è®¤æ˜¾ç¤ºç»“æ„

```jsx
<ul class="goods-list" v-else>
  <li v-for="item in 4" :key="item">
    <XtxSkeleton :width="306" :height="406" bg="rgba(255,255,255,0.2)" />
  </li>
</ul>
```



## `Pinia` æŒä¹…åŒ–å­˜å‚¨ - é¦–é¡µæ•°æ®ç¼“å­˜ 

**ç›®æ ‡ï¼š** é€šè¿‡ `Pinia` æ’ä»¶å¿«é€Ÿå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚

æ’ä»¶æ–‡æ¡£ï¼š[ç‚¹å‡»æŸ¥çœ‹](https://www.npmjs.com/package/pinia-plugin-persistedstate)

### ç”¨æ³•

**å®‰è£…**

```shell
yarn add pinia-plugin-persistedstate
# æˆ–
npm i pinia-plugin-persistedstate
```

**ä½¿ç”¨æ’ä»¶**

```diff
+ import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia();
+ pinia.use(piniaPluginPersistedstate);
app.use(pinia);
```

**æ¨¡å—å¼€å¯æŒä¹…åŒ–**

```diff
const useHomeStore = defineStore("home",{
+  persist: true
   state:()=>({})
  // ...çœç•¥
});
```



### å¸¸è§ç–‘é—®

- `Vue2` èƒ½ä¸èƒ½ç”¨ `Pinia` å’Œ æŒä¹…åŒ–å­˜å‚¨æ’ä»¶ã€‚
  - å¯ä»¥ä½¿ç”¨ï¼Œéœ€é…åˆ  `@vue/composition-api` å…ˆè®© `Vue2` è€é¡¹ç›®æ”¯æŒ `ç»„åˆå¼API`ã€‚
  - `Pinia` èƒ½åœ¨ `ç»„åˆå¼API` ä¸­ä½¿ç”¨ã€‚
- æ¨¡å—åšäº†æŒä¹…åŒ–åï¼Œä»¥åæ•°æ®ä¼šä¸ä¼šå˜ï¼Œæ€ä¹ˆåŠï¼Ÿ
  - å…ˆè¯»å–æœ¬åœ°çš„æ•°æ®ï¼Œå¦‚æœæ–°çš„è¯·æ±‚è·å–åˆ°æ–°æ•°æ®ï¼Œä¼šè‡ªåŠ¨æŠŠæ–°æ•°æ®è¦†ç›–æ‰æ—§çš„æ•°æ®ã€‚
  - æ— éœ€é¢å¤–å¤„ç†ï¼Œæ’ä»¶ä¼šè‡ªå·±æ›´æ–°åˆ°æœ€æ–°æ•°æ®ã€‚





### è¿›é˜¶ç”¨æ³•

éœ€æ±‚ï¼šä¸æƒ³æ‰€æœ‰æ•°æ®éƒ½æŒä¹…åŒ–å¤„ç†ï¼Œèƒ½ä¸èƒ½æŒ‰éœ€æŒä¹…åŒ–æ‰€éœ€æ•°æ®ï¼Œæ€ä¹ˆåŠï¼Ÿ

- å¯ä»¥ç”¨é…ç½®å¼å†™æ³•ï¼ŒæŒ‰éœ€ç¼“å­˜æŸäº›æ¨¡å—çš„æ•°æ®ã€‚

```ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  state: () => ({
      someState: 'hello pinia',
      nested: {
        data: 'nested pinia',
      },
  }),
  // æ‰€æœ‰æ•°æ®æŒä¹…åŒ–
  // persist: true,
  // æŒä¹…åŒ–å­˜å‚¨æ’ä»¶å…¶ä»–é…ç½®
  persist: {
    // ä¿®æ”¹å­˜å‚¨ä¸­ä½¿ç”¨çš„é”®åç§°ï¼Œé»˜è®¤ä¸ºå½“å‰ Storeçš„ id
    key: 'storekey',
    // ä¿®æ”¹ä¸º sessionStorageï¼Œé»˜è®¤ä¸º localStorage
    storage: window.sessionStorage,
    // ğŸ‰æŒ‰éœ€æŒä¹…åŒ–ï¼Œé»˜è®¤ä¸å†™ä¼šå­˜å‚¨å…¨éƒ¨
    paths: ['nested.data'],
  },
})
```

